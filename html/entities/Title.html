<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Title.cs - Entity - Documentation XtraWork</title>
<style>
	.gpt15 {
		--text: #1f2937; --muted: #374151; --title: #111827; --blue: #2563eb; --green: #22c55e; --orange: #f59e0b; --red: #ef4444; --violet: #7c3aed; --cyan: #06b6d4; --yellow: #eab308; --slate: #0f172a; --bg: #ffffff; --soft: #f8fafc; --soft-blue: #eff6ff; --soft-green: #f0fdf4; --soft-orange: #fffbeb; --soft-red: #fef2f2; --border: #e5e7eb; --border-strong: #cbd5e1; --shadow: 0 6px 18px rgba(17, 24, 39, .06);
	}
	.gpt15 .page { max-width: 980px; margin: 40px auto 80px; padding: 24px 24px 32px; color: var(--text); font-family: "Segoe UI", Roboto, Arial, Helvetica, sans-serif; line-height: 1.7; background: var(--bg); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
	.gpt15 h1, .gpt15 h2, .gpt15 h3 { color: var(--title); font-weight: 700; line-height: 1.2; margin: 1.25rem 0 .75rem }
	.gpt15 h1 { font-size: 2rem; letter-spacing: .2px }
	.gpt15 .meta { color: var(--blue); font-weight: 600; margin: -.25rem 0 1.1rem }
	.gpt15 .hr { height: 1px; background: linear-gradient(90deg, transparent, #93c5fd, transparent); border: none; margin: 1.25rem 0 }
	.gpt15 .callout { background: var(--soft); color: var(--text); border: 1px solid var(--border); border-left-width: 6px; border-radius: 12px; padding: 14px 16px; margin: 16px 0 }
	.gpt15 .callout.note { border-left-color: #1e90ff; background: var(--soft-blue) }
	.gpt15 .callout.tip { border-left-color: var(--green); background: var(--soft-green) }
	.gpt15 .callout.warn { border-left-color: var(--red); background: var(--soft-red) }
	.gpt15 .callout.copilot { border-left-color: var(--violet); background: #faf5ff; }
	.gpt15 .card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 14px 16px; box-shadow: 0 2px 10px rgba(17, 24, 39, .04); }
	.gpt15 .grid-2 { display: grid; grid-template-columns: 1fr; gap: 16px }
	.gpt15 .grid-3 { display: grid; grid-template-columns: 1fr; gap: 16px }
	@media (min-width:860px) {
		.gpt15 .grid-2 { grid-template-columns: 1fr 1fr }
		.gpt15 .grid-3 { grid-template-columns: 1fr 1fr 1fr }
	}
	.gpt15 .checklist li { margin: .3rem 0; list-style: none; position: relative; padding-left: 1.2rem }
	.gpt15 .checklist li::before { content: ""; position: absolute; left: 0; top: .45rem; width: .65rem; height: .65rem; border-radius: 3px; background: linear-gradient(135deg, var(--green), #86efac) }
	.gpt15 .snippet { background: var(--soft); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; font-size: .9rem; white-space: pre-wrap; tab-size: 4; overflow-x: auto; }
	.gpt15 .snippet pre { margin: 0; white-space: pre; tab-size: 4; }
	.gpt15 .snippet.bash { border-left: 4px solid var(--green); background: var(--soft-green); white-space: pre; }
	.gpt15 table { width: 100%; border-collapse: collapse; margin: 20px 0; }
	.gpt15 th, .gpt15 td { border: 1px solid var(--border); padding: 12px; text-align: left; }
	.gpt15 th { background: var(--soft-blue); font-weight: 600; }
	.gpt15 code { background: var(--soft); color: var(--red); padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: .9em; }
</style>
</head>
<body>
<section class="gpt15" id="gpt15">
	<div class="page">

		<h1>Title.cs - Entite Titre de Poste</h1>

		<p class="meta">COUCHE 1 : ENTITIES &bull; Represente un titre/poste dans l'entreprise</p>
		<div class="callout note"><strong>Role de cette classe</strong> &mdash; La classe <code>Title</code> est une entite qui represente un titre de poste (Directeur, Manager, Developpeur, etc.) dans la base de donnees XtraWork. Elle est liee aux employes via une relation un-a-plusieurs (1:N).</div>
		<div class="hr"><br></div>

		<h2>Code Source Complet</h2>
		
		<div class="snippet"><pre><code>using System.ComponentModel.DataAnnotations;

namespace XtraWork.Entities;

public class Title
{
    public Guid Id { get; set; }
    
    [Required]
    [MaxLength(100)]
    public string Description { get; set; } = string.Empty;
    
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    
    // Navigation property
    public ICollection&lt;Employee&gt; Employees { get; set; } = new List&lt;Employee&gt;();
}</code></pre></div>

		<div class="hr"><br></div>

		<h2>Explication Detaillee Propriete par Propriete</h2>

		<h3>Propriete Id - Cle Primaire</h3>
		<div class="snippet"><pre><code>public Guid Id { get; set; }</code></pre></div>
		<div class="callout note">
			<strong>Identifiant unique du titre de poste</strong><br><br>
			Type <code>Guid</code> : identifiant universel de 128 bits qui garantit l'unicite.<br><br>
			<strong>Exemple de valeur :</strong> <code>a3f8d9c2-4b7e-4c8a-9f2d-1e3b5c7d9a4f</code><br><br>
			<strong>Cle primaire :</strong> Entity Framework detecte automatiquement qu'une propriete nommee <code>Id</code> est la cle primaire de la table.<br><br>
			<strong>En base de donnees SQL :</strong> Cette propriete devient la colonne <code>Id</code> de type <code>UNIQUEIDENTIFIER PRIMARY KEY</code> dans la table <code>Titles</code>.
		</div>

		<h3>Propriete Description - Nom du poste</h3>
		<div class="snippet"><pre><code>[Required]
[MaxLength(100)]
public string Description { get; set; } = string.Empty;</code></pre></div>
		<div class="callout tip">
			<strong>Nom du titre de poste</strong><br><br>
			<strong>Attribut [Required] :</strong><br>
			&bull; Cette propriete est obligatoire<br>
			&bull; Ne peut pas etre vide ou null<br>
			&bull; En SQL : <code>NOT NULL</code><br><br>
			<strong>Attribut [MaxLength(100)] :</strong><br>
			&bull; Maximum 100 caracteres<br>
			&bull; En SQL : <code>NVARCHAR(100)</code><br><br>
			<strong>Exemples de valeurs :</strong><br>
			&bull; "Directeur General"<br>
			&bull; "Manager"<br>
			&bull; "Developpeur Senior .NET"<br>
			&bull; "Analyste Business"<br>
			&bull; "Chef de Projet"<br>
			&bull; "Technicien Support IT"<br><br>
			<strong>En base de donnees :</strong> Colonne <code>Description</code> de type <code>NVARCHAR(100) NOT NULL</code>
		</div>

		<h3>Propriete CreatedAt - Date de creation</h3>
		<div class="snippet"><pre><code>public DateTime CreatedAt { get; set; } = DateTime.UtcNow;</code></pre></div>
		<div class="callout note">
			<strong>Date de creation du titre</strong><br><br>
			<code>DateTime.UtcNow</code> : date et heure actuelle en UTC (Temps Universel Coordonne).<br><br>
			<strong>Utilite :</strong> Permet de savoir quand un titre a ete cree dans le systeme. Utile pour l'audit et le suivi.<br><br>
			<strong>En base de donnees :</strong> Colonne <code>CreatedAt</code> de type <code>DATETIME2</code> avec valeur par defaut SQL <code>GETUTCDATE()</code> (configure dans XtraWorkContext.OnModelCreating).
		</div>

		<h3>Propriete Employees - Navigation Property (Relation)</h3>
		<div class="snippet"><pre><code>public ICollection&lt;Employee&gt; Employees { get; set; } = new List&lt;Employee&gt;();</code></pre></div>
		<div class="callout warn">
			<strong>Relation 1:N - Un titre peut avoir plusieurs employes</strong><br><br>
			<strong>Qu'est-ce qu'une Navigation Property ?</strong><br>
			C'est une propriete qui represente la relation avec une autre entite. Elle permet de "naviguer" de Title vers ses Employee associes.<br><br>
			<strong>Type ICollection&lt;Employee&gt; :</strong><br>
			&bull; <code>ICollection</code> est une interface pour une collection (liste) d'elements<br>
			&bull; <code>&lt;Employee&gt;</code> signifie que c'est une collection d'employes<br>
			&bull; Initialise avec <code>new List&lt;Employee&gt;()</code> pour eviter les valeurs null<br><br>
			<strong>Exemple concret de la relation :</strong><br>
			Le titre "Manager" peut avoir plusieurs employes :<br>
			&bull; Employee "Jean Dupont" (TitleId pointe vers le Title "Manager")<br>
			&bull; Employee "Marie Martin" (TitleId pointe vers le Title "Manager")<br>
			&bull; Employee "Pierre Durand" (TitleId pointe vers le Title "Manager")<br><br>
			<strong>Utilisation dans le code :</strong><br>
			<code>var title = await _context.Titles.Include(t => t.Employees).FirstAsync();</code><br>
			<code>Console.WriteLine($"{title.Description} a {title.Employees.Count} employes");</code><br><br>
			<strong>TRES IMPORTANT :</strong><br>
			&bull; Cette propriete n'est PAS une colonne dans la table SQL Titles !<br>
			&bull; Elle existe uniquement en C# pour la navigation dans Entity Framework<br>
			&bull; La relation est stockee dans la table Employees via la colonne TitleId (cle etrangere)<br>
			&bull; Pour charger cette collection, vous DEVEZ utiliser <code>.Include(t => t.Employees)</code><br>
			&bull; Sans Include(), la collection sera vide meme s'il y a des employes en base de donnees
		</div>

		<div class="hr"><br></div>

		<h2>Table SQL Generee</h2>

		<div class="callout tip"><strong>Code First</strong> &mdash; Entity Framework genere automatiquement la table <code>Titles</code> a partir de cette classe C# quand vous appelez <code>context.Database.EnsureCreated()</code>.</div>

		<table>
			<thead>
				<tr>
					<th>Colonne SQL</th>
					<th>Type SQL</th>
					<th>Propriete C#</th>
					<th>Contraintes</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><code>Id</code></td>
					<td><code>UNIQUEIDENTIFIER</code></td>
					<td><code>Guid Id</code></td>
					<td><strong>PRIMARY KEY</strong></td>
				</tr>
				<tr>
					<td><code>Description</code></td>
					<td><code>NVARCHAR(100)</code></td>
					<td><code>string Description</code></td>
					<td><strong>NOT NULL</strong></td>
				</tr>
				<tr>
					<td><code>CreatedAt</code></td>
					<td><code>DATETIME2</code></td>
					<td><code>DateTime CreatedAt</code></td>
					<td><strong>DEFAULT GETUTCDATE()</strong></td>
				</tr>
			</tbody>
		</table>

		<div class="callout note"><strong>Note importante sur la propriete Employees</strong> &mdash; La propriete <code>Employees</code> n'apparait PAS dans cette table car c'est une Navigation Property. La relation est stockee dans la table <code>Employees</code> ou la colonne <code>TitleId</code> (cle etrangere) pointe vers <code>Titles.Id</code>.</div>

		<div class="hr"><br></div>

		<h2>Relation avec Employee (1:N)</h2>

		<div class="callout warn"><strong>Relation Un-a-Plusieurs</strong> &mdash; Un titre peut etre attribue a plusieurs employes, mais un employe n'a qu'un seul titre a la fois.</div>

		<h3>Schema de la relation</h3>
		<div class="snippet"><pre><code>Title "Manager" (Id: guid-123)
  |
  +-- Employee "Jean Dupont" (TitleId: guid-123)
  |
  +-- Employee "Marie Martin" (TitleId: guid-123)
  |
  +-- Employee "Pierre Durand" (TitleId: guid-123)</code></pre></div>

		<h3>Configuration dans XtraWorkContext</h3>
		<div class="snippet"><pre><code>// Dans OnModelCreating()
modelBuilder.Entity&lt;Employee&gt;(entity =>
{
    // Definition de la relation Employee -> Title
    entity.HasOne(e => e.Title)                // Un Employee a UN Title
          .WithMany(t => t.Employees)          // Un Title a PLUSIEURS Employees
          .HasForeignKey(e => e.TitleId)       // Cle etrangere : Employee.TitleId
          .OnDelete(DeleteBehavior.Restrict);  // Empeche la suppression si des employes existent
});</code></pre></div>

		<div class="callout copilot">
			<strong>Explication de la configuration :</strong><br><br>
			<strong>1. HasOne(e => e.Title)</strong><br>
			&bull; Definit le cote "un" de la relation<br>
			&bull; Un employe a UN seul titre<br><br>
			<strong>2. WithMany(t => t.Employees)</strong><br>
			&bull; Definit le cote "plusieurs" de la relation<br>
			&bull; Un titre peut avoir PLUSIEURS employes<br><br>
			<strong>3. HasForeignKey(e => e.TitleId)</strong><br>
			&bull; Specifie que la propriete <code>Employee.TitleId</code> est la cle etrangere<br>
			&bull; Cree une contrainte FOREIGN KEY en SQL<br>
			&bull; SQL genere : <code>FOREIGN KEY (TitleId) REFERENCES Titles(Id)</code><br><br>
			<strong>4. OnDelete(DeleteBehavior.Restrict)</strong><br>
			&bull; Protection contre la suppression accidentelle<br>
			&bull; Si vous essayez de supprimer un Title qui a des Employees, SQL retournera une erreur<br>
			&bull; Empeche les "donnees orphelines" (employes sans titre)<br>
			&bull; Alternatives : <code>Cascade</code> (supprime aussi les employes) ou <code>SetNull</code> (met TitleId a NULL)
		</div>

		<div class="hr"><br></div>

		<h2>Utilisee par d'autres classes</h2>

		<div class="grid-2">
			<div class="card">
				<h3>Repositories</h3>
				<p><strong>TitleRepository.cs</strong> - Gestion CRUD</p>
				<ul class="checklist">
					<li><code>GetAllAsync()</code> - Liste tous les titres tries par description</li>
					<li><code>GetByIdAsync(Guid id)</code> - Recherche par ID avec Include(Employees)</li>
					<li><code>CreateAsync(Title title)</code> - Creer un nouveau titre</li>
					<li><code>UpdateAsync(Title title)</code> - Modifier un titre existant</li>
					<li><code>DeleteAsync(Guid id)</code> - Supprimer un titre</li>
					<li><code>ExistsAsync(Guid id)</code> - Verifier si un titre existe</li>
				</ul>
			</div>
			
			<div class="card">
				<h3>Services</h3>
				<p><strong>TitleService.cs</strong> - Logique metier</p>
				<ul class="checklist">
					<li>Transformation Title → TitleResponse</li>
					<li>Transformation TitleRequest → Title</li>
					<li>Validation des donnees</li>
					<li>Gestion des exceptions NotFoundException</li>
					<li>Generation automatique de l'Id avec Guid.NewGuid()</li>
				</ul>
			</div>
		</div>

		<div class="grid-2">
			<div class="card">
				<h3>Controllers</h3>
				<p><strong>TitleController.cs</strong> - Endpoints API REST</p>
				<ul class="checklist">
					<li><code>GET /api/title</code> - Liste tous les titres (authentification requise)</li>
					<li><code>GET /api/title/{id}</code> - Details d'un titre</li>
					<li><code>POST /api/title</code> - Creer un titre (Admin uniquement)</li>
					<li><code>PUT /api/title/{id}</code> - Modifier (Manager ou Admin)</li>
					<li><code>DELETE /api/title/{id}</code> - Supprimer (Admin uniquement)</li>
				</ul>
			</div>
			
			<div class="card">
				<h3>Entites liees</h3>
				<p><strong>Employee.cs</strong> - Relation inverse</p>
				<ul class="checklist">
					<li>Chaque Employee a une propriete TitleId (FK)</li>
					<li>Chaque Employee a une Navigation Property Title</li>
					<li>Plusieurs Employees peuvent avoir le meme Title</li>
				</ul>
			</div>
		</div>

		<div class="hr"><br></div>

		<h2>Exemples de Code Pratiques</h2>

		<h3>Exemple 1 : Creer un nouveau titre</h3>
		<div class="snippet"><pre><code>// Dans TitleService.Create()
var title = new Title
{
    Id = Guid.NewGuid(),  // Genere un nouveau GUID unique
    Description = "Developpeur Senior .NET",
    CreatedAt = DateTime.UtcNow
};

await titleRepository.CreateAsync(title);

Console.WriteLine($"Titre cree : {title.Description}");
Console.WriteLine($"ID : {title.Id}");</code></pre></div>

		<h3>Exemple 2 : Recuperer un titre avec tous ses employes</h3>
		<div class="snippet"><pre><code>// Dans TitleRepository.GetByIdAsync()
var title = await _context.Titles
    .Include(t => t.Employees)  // Charger tous les employes de ce titre
    .FirstOrDefaultAsync(t => t.Id == titleId);

if (title != null)
{
    Console.WriteLine($"Titre : {title.Description}");
    Console.WriteLine($"Nombre d'employes : {title.Employees.Count}");
    
    foreach (var employee in title.Employees)
    {
        Console.WriteLine($"  - {employee.FirstName} {employee.LastName}");
    }
}</code></pre></div>

		<h3>Exemple 3 : Modifier un titre</h3>
		<div class="snippet"><pre><code>// Dans TitleService.Update()
var title = await titleRepository.GetByIdAsync(titleId);

if (title == null)
{
    throw new NotFoundException($"Titre avec l'ID {titleId} non trouve");
}

title.Description = "Chef de Projet Senior";

await titleRepository.UpdateAsync(title);

Console.WriteLine($"Titre modifie : {title.Description}");</code></pre></div>

		<h3>Exemple 4 : Supprimer un titre (avec verification)</h3>
		<div class="snippet"><pre><code>// Recuperer le titre avec ses employes
var title = await _context.Titles
    .Include(t => t.Employees)
    .FirstOrDefaultAsync(t => t.Id == titleId);

if (title == null)
{
    throw new NotFoundException("Titre non trouve");
}

// Verifier s'il y a des employes avec ce titre
if (title.Employees.Any())
{
    Console.WriteLine($"ERREUR : Impossible de supprimer le titre '{title.Description}'");
    Console.WriteLine($"Il y a {title.Employees.Count} employe(s) avec ce titre");
    Console.WriteLine("Veuillez d'abord reassigner ou supprimer ces employes");
}
else
{
    await titleRepository.DeleteAsync(titleId);
    Console.WriteLine($"Titre '{title.Description}' supprime avec succes");
}</code></pre></div>

		<h3>Exemple 5 : Lister tous les titres avec le nombre d'employes</h3>
		<div class="snippet"><pre><code>var titles = await _context.Titles
    .Include(t => t.Employees)  // Charger la collection d'employes
    .OrderBy(t => t.Description)
    .ToListAsync();

Console.WriteLine("Liste des titres :");
foreach (var title in titles)
{
    Console.WriteLine($"{title.Description} : {title.Employees.Count} employe(s)");
}</code></pre></div>

		<div class="hr"><br></div>

		<h2>Concepts Cles a Retenir</h2>

		<div class="grid-3">
			<div class="card">
				<h3>Navigation Property</h3>
				<p>Propriete qui represente une relation entre entites. Permet de naviguer d'une entite a l'autre. N'est PAS une colonne en base de donnees.</p>
			</div>
			
			<div class="card">
				<h3>Relation 1:N (Un-a-Plusieurs)</h3>
				<p>Un titre peut avoir plusieurs employes, mais un employe n'a qu'un seul titre. Relation un-a-plusieurs.</p>
			</div>
			
			<div class="card">
				<h3>Foreign Key (Cle Etrangere)</h3>
				<p>La table Employees a une colonne TitleId qui pointe vers Titles.Id. C'est la cle etrangere qui etablit la relation.</p>
			</div>
		</div>

		<div class="grid-3">
			<div class="card">
				<h3>ICollection&lt;T&gt;</h3>
				<p>Interface pour une collection d'elements. Ici, une liste d'employes. Permet Add(), Remove(), Count, etc.</p>
			</div>
			
			<div class="card">
				<h3>Include() - Eager Loading</h3>
				<p>Methode LINQ pour charger les relations. Sans Include(), la Navigation Property sera vide (null ou collection vide).</p>
			</div>
			
			<div class="card">
				<h3>DeleteBehavior.Restrict</h3>
				<p>Empeche la suppression d'un titre si des employes l'utilisent. Protection contre les donnees orphelines.</p>
			</div>
		</div>

		<div class="hr"><br></div>

		<h2>Navigation Documentation</h2>

		<div class="grid-2">
			<div class="card">
				<h3>Fichiers Lies</h3>
				<ul class="checklist">
					<li><a href="Employee.html">Employee.cs</a> - Entite employe (relation inverse)</li>
					<li><a href="../repositories/TitleRepository.html">TitleRepository.cs</a> - Acces donnees CRUD</li>
					<li><a href="../repositories/XtraWorkContext.html">XtraWorkContext.cs</a> - Configuration de la relation</li>
					<li><a href="../services/TitleService.html">TitleService.cs</a> - Logique metier</li>
					<li><a href="../controllers/TitleController.html">TitleController.cs</a> - Endpoints API REST</li>
				</ul>
			</div>
			
			<div class="card">
				<h3>Autres Entites</h3>
				<ul class="checklist">
					<li><a href="User.html">User.cs</a> - Entite utilisateur</li>
					<li><a href="Employee.html">Employee.cs</a> - Entite employe</li>
				</ul>
				<br>
				<p><a href="../index.html">Retour a l'index principal</a></p>
			</div>
		</div>

		<div class="callout tip" style="margin-top: 30px;">
			<strong>Prochaine etape</strong> &mdash; Passez a <a href="Employee.html">Employee.cs</a> pour voir l'entite employe et la relation inverse (N:1) !
		</div>

		<div class="hr"><br></div>

		<p class="center"><strong>Documentation XtraWork API</strong> &bull; <em>Explications detaillees pour etudiants</em></p>
	</div>
</section>
</body>
</html>