<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>XtraWorkContext.cs - DbContext - Documentation XtraWork</title>
<style>
	.gpt15 {
		--text: #1f2937; --muted: #374151; --title: #111827; --blue: #2563eb; --green: #22c55e; --orange: #f59e0b; --red: #ef4444; --violet: #7c3aed; --cyan: #06b6d4; --yellow: #eab308; --slate: #0f172a; --bg: #ffffff; --soft: #f8fafc; --soft-blue: #eff6ff; --soft-green: #f0fdf4; --soft-orange: #fffbeb; --soft-red: #fef2f2; --border: #e5e7eb; --border-strong: #cbd5e1; --shadow: 0 6px 18px rgba(17, 24, 39, .06);
	}
	.gpt15 .page { max-width: 980px; margin: 40px auto 80px; padding: 24px 24px 32px; color: var(--text); font-family: "Segoe UI", Roboto, Arial, Helvetica, sans-serif; line-height: 1.7; background: var(--bg); border: 1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); }
	.gpt15 h1, .gpt15 h2, .gpt15 h3 { color: var(--title); font-weight: 700; line-height: 1.2; margin: 1.25rem 0 .75rem }
	.gpt15 h1 { font-size: 2rem; letter-spacing: .2px }
	.gpt15 .meta { color: var(--blue); font-weight: 600; margin: -.25rem 0 1.1rem }
	.gpt15 .hr { height: 1px; background: linear-gradient(90deg, transparent, #93c5fd, transparent); border: none; margin: 1.25rem 0 }
	.gpt15 .callout { background: var(--soft); color: var(--text); border: 1px solid var(--border); border-left-width: 6px; border-radius: 12px; padding: 14px 16px; margin: 16px 0 }
	.gpt15 .callout.note { border-left-color: #1e90ff; background: var(--soft-blue) }
	.gpt15 .callout.tip { border-left-color: var(--green); background: var(--soft-green) }
	.gpt15 .callout.warn { border-left-color: var(--red); background: var(--soft-red) }
	.gpt15 .callout.copilot { border-left-color: var(--violet); background: #faf5ff; }
	.gpt15 .card { background: #fff; border: 1px solid var(--border); border-radius: 14px; padding: 14px 16px; box-shadow: 0 2px 10px rgba(17, 24, 39, .04); }
	.gpt15 .grid-2 { display: grid; grid-template-columns: 1fr; gap: 16px }
	.gpt15 .grid-3 { display: grid; grid-template-columns: 1fr; gap: 16px }
	@media (min-width:860px) {
		.gpt15 .grid-2 { grid-template-columns: 1fr 1fr }
		.gpt15 .grid-3 { grid-template-columns: 1fr 1fr 1fr }
	}
	.gpt15 .checklist li { margin: .3rem 0; list-style: none; position: relative; padding-left: 1.2rem }
	.gpt15 .checklist li::before { content: ""; position: absolute; left: 0; top: .45rem; width: .65rem; height: .65rem; border-radius: 3px; background: linear-gradient(135deg, var(--green), #86efac) }
	.gpt15 .snippet { background: var(--soft); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; font-size: .9rem; white-space: pre-wrap; tab-size: 4; overflow-x: auto; }
	.gpt15 .snippet pre { margin: 0; white-space: pre; tab-size: 4; }
	.gpt15 table { width: 100%; border-collapse: collapse; margin: 20px 0; }
	.gpt15 th, .gpt15 td { border: 1px solid var(--border); padding: 12px; text-align: left; }
	.gpt15 th { background: var(--soft-blue); font-weight: 600; }
	.gpt15 code { background: var(--soft); color: var(--red); padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: .9em; }
</style>
</head>
<body>
<section class="gpt15" id="gpt15">
	<div class="page">

		<h1>XtraWorkContext.cs - DbContext Principal</h1>

		<p class="meta">COUCHE 2 : REPOSITORIES &bull; DbContext Entity Framework Core</p>
		<div class="callout note"><strong>Role</strong> &mdash; <code>XtraWorkContext</code> est le DbContext principal. C'est le pont entre C# et SQL Server. Il definit les tables (DbSet) et configure les relations entre entites dans <code>OnModelCreating()</code>.</div>
		<div class="hr"><br></div>

		<h2>Code Source Complet</h2>
		
		<div class="snippet"><pre><code>using Microsoft.EntityFrameworkCore;
using XtraWork.Entities;

namespace XtraWork.Repositories;

public class XtraWorkContext : DbContext
{
    public XtraWorkContext(DbContextOptions&lt;XtraWorkContext&gt; options) : base(options)
    {
    }

    public DbSet&lt;User&gt; Users { get; set; }
    public DbSet&lt;Title&gt; Titles { get; set; }
    public DbSet&lt;Employee&gt; Employees { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // Configuration User
        modelBuilder.Entity&lt;User&gt;(entity =>
        {
            entity.HasKey(u => u.Id);
            entity.Property(u => u.Username).IsRequired().HasMaxLength(50);
            entity.Property(u => u.Email).IsRequired().HasMaxLength(100);
            entity.Property(u => u.Role).HasMaxLength(20).HasDefaultValue("User");
            entity.HasIndex(u => u.Username).IsUnique();
            entity.HasIndex(u => u.Email).IsUnique();
        });

        // Configuration Title
        modelBuilder.Entity&lt;Title&gt;(entity =>
        {
            entity.HasKey(t => t.Id);
            entity.Property(t => t.Description).IsRequired().HasMaxLength(100);
            entity.Property(t => t.CreatedAt).HasDefaultValueSql("GETUTCDATE()");
        });

        // Configuration Employee
        modelBuilder.Entity&lt;Employee&gt;(entity =>
        {
            entity.HasKey(e => e.Id);
            entity.Property(e => e.FirstName).IsRequired().HasMaxLength(50);
            entity.Property(e => e.LastName).IsRequired().HasMaxLength(50);
            entity.Property(e => e.Gender).IsRequired().HasMaxLength(10);
            entity.Property(e => e.CreatedAt).HasDefaultValueSql("GETUTCDATE()");

            // Relation Employee -> Title
            entity.HasOne(e => e.Title)
                  .WithMany(t => t.Employees)
                  .HasForeignKey(e => e.TitleId)
                  .OnDelete(DeleteBehavior.Restrict);
        });

        base.OnModelCreating(modelBuilder);
    }
}</code></pre></div>

		<div class="hr"><br></div>

		<h2>Explication Detaillee</h2>

		<h3>Qu'est-ce qu'un DbContext ?</h3>
		<div class="callout copilot">
			<strong>DbContext = Pont entre C# et SQL Server</strong><br><br>
			Le DbContext est la classe centrale d'Entity Framework Core. C'est un pont entre votre code C# oriente objet et la base de donnees SQL relationnelle.<br><br>
			<strong>Analogie simple :</strong> Imaginez le DbContext comme un traducteur. Vous parlez en C# (objets, proprietes, LINQ) et la base de donnees parle en SQL (tables, colonnes, SELECT/INSERT). Le DbContext traduit automatiquement entre les deux langages !
		</div>

		<h3>DbSet - Representation des tables</h3>
		<div class="snippet"><pre><code>public DbSet&lt;User&gt; Users { get; set; }
public DbSet&lt;Title&gt; Titles { get; set; }
public DbSet&lt;Employee&gt; Employees { get; set; }</code></pre></div>
		<div class="callout note">
			<strong>DbSet = Table SQL</strong><br><br>
			&bull; <code>DbSet&lt;User&gt;</code> represente la table <code>Users</code><br>
			&bull; <code>DbSet&lt;Title&gt;</code> represente la table <code>Titles</code><br>
			&bull; <code>DbSet&lt;Employee&gt;</code> represente la table <code>Employees</code><br><br>
			<strong>Utilisation :</strong><br>
			<code>var users = await _context.Users.ToListAsync();</code><br>
			<code>var user = await _context.Users.FindAsync(userId);</code><br>
			<code>_context.Users.Add(newUser);</code>
		</div>

		<h3>OnModelCreating() - Configuration des relations</h3>
		<div class="callout warn">
			<strong>Methode CRUCIALE</strong> &mdash; <code>OnModelCreating()</code> est appelee automatiquement par EF Core lors de la creation du modele de base de donnees. C'est ici que vous configurez TOUTES les relations, contraintes, index et regles de votre BDD.
		</div>

		<h3>Configuration de la relation Employee -> Title</h3>
		<div class="snippet"><pre><code>entity.HasOne(e => e.Title)           // Un Employee a UN Title
      .WithMany(t => t.Employees)     // Un Title a PLUSIEURS Employees
      .HasForeignKey(e => e.TitleId)  // Cle etrangere
      .OnDelete(DeleteBehavior.Restrict);</code></pre></div>
		<div class="callout tip">
			<strong>Decortiquons ligne par ligne :</strong><br><br>
			<strong>1. HasOne(e => e.Title)</strong><br>
			&bull; Un employe a UN seul titre<br>
			&bull; Definit la Navigation Property cote Employee<br><br>
			<strong>2. WithMany(t => t.Employees)</strong><br>
			&bull; Un titre peut avoir PLUSIEURS employes<br>
			&bull; Definit la collection cote Title<br><br>
			<strong>3. HasForeignKey(e => e.TitleId)</strong><br>
			&bull; La propriete <code>Employee.TitleId</code> est la cle etrangere<br>
			&bull; Pointe vers <code>Titles.Id</code><br>
			&bull; SQL : <code>FOREIGN KEY (TitleId) REFERENCES Titles(Id)</code><br><br>
			<strong>4. OnDelete(DeleteBehavior.Restrict)</strong><br>
			&bull; Protection contre suppression accidentelle<br>
			&bull; Si vous essayez de supprimer un Title qui a des Employees, SQL retourne une erreur<br>
			&bull; Empeche les donnees orphelines
		</div>

		<div class="hr"><br></div>

		<h2>Exemples</h2>

		<h3>Exemple : Utilisation dans un Repository</h3>
		<div class="snippet"><pre><code>public class EmployeeRepository
{
    private readonly XtraWorkContext _context;
    
    public EmployeeRepository(XtraWorkContext context)
    {
        _context = context;  // Injection du DbContext
    }
    
    public async Task&lt;List&lt;Employee&gt;&gt; GetAllAsync()
    {
        return await _context.Employees
            .Include(e => e.Title)
            .ToListAsync();
    }
}</code></pre></div>

		<div class="hr"><br></div>

		<h2>Navigation</h2>

		<div class="grid-2">
			<div class="card">
				<ul class="checklist">
					<li><a href="../entities/User.html">User.cs</a></li>
					<li><a href="../entities/Title.html">Title.cs</a></li>
					<li><a href="../entities/Employee.html">Employee.cs</a></li>
					<li><a href="UserRepository.html">UserRepository.cs</a></li>
					<li><a href="TitleRepository.html">TitleRepository.cs</a></li>
					<li><a href="EmployeeRepository.html">EmployeeRepository.cs</a></li>
				</ul>
			</div>
			<div class="card">
				<p><a href="../index.html">Retour a l'index</a></p>
			</div>
		</div>

		<div class="hr"><br></div>
		<p class="center"><strong>Documentation XtraWork API</strong></p>
	</div>
</section>
</body>
</html>